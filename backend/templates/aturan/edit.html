{% extends 'base.html' %}

{% block title %}Edit Aturan - Sistem Pakar{% endblock %}

{% block extra_css %}
<style>
    /* Alert positioning */
    .alert-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        width: 320px;
        max-width: 90vw;
    }

    @media (max-width: 640px) {
        .alert-container {
            top: 10px;
            right: 10px;
            width: 280px;
        }
    }

    @keyframes fadeOut {
        0% { opacity: 1; }
        100% { opacity: 0; }
    }

    .fade-out {
        animation: fadeOut 0.5s ease-out forwards;
    }
</style>
{% endblock %}

{% block content %}
<!-- Flash Messages - Fixed Position -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="alert-container">
        {% for category, message in messages %}
        <div class="alert-item mb-2 animate-fade-in">
            <div class="bg-white rounded-lg p-3 shadow-md {% if category == 'success' %}border-l-4 border-green-500{% elif category == 'danger' or category == 'error' %}border-l-4 border-red-500{% elif category == 'warning' %}border-l-4 border-yellow-500{% else %}border-l-4 border-blue-500{% endif %}">
                <div class="flex items-center space-x-2">
                    <i class="bi {% if category == 'success' %}bi-check-circle-fill text-green-500{% elif category == 'danger' or category == 'error' %}bi-x-circle-fill text-red-500{% elif category == 'warning' %}bi-exclamation-triangle-fill text-yellow-500{% else %}bi-info-circle-fill text-blue-500{% endif %} text-base flex-shrink-0"></i>
                    <span class="text-gray-700 font-medium text-xs flex-1">{{ message }}</span>
                    <button onclick="dismissAlert(this)" class="text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0">
                        <i class="bi bi-x text-base"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
{% endwith %}

<!-- Page Header -->
<div class="mb-6 sm:mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 animate-fade-in">
    <div>
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 flex items-center space-x-2 sm:space-x-3">
            <div class="w-9 h-9 sm:w-10 sm:h-10 bg-amber-50 rounded-lg flex items-center justify-center">
                <i class="bi bi-pencil-square text-amber-600 text-lg sm:text-xl"></i>
            </div>
            <span>Edit Aturan</span>
        </h1>
        <p class="text-sm sm:text-base text-gray-500 mt-2">Perbarui aturan basis pengetahuan</p>
    </div>
    
    <a href="{{ url_for('aturan.index') }}" 
       class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg transition-all duration-200 flex items-center justify-center sm:justify-start space-x-2 border border-gray-200 text-sm sm:text-base">
        <i class="bi bi-arrow-left"></i>
        <span>Kembali</span>
    </a>
</div>

<!-- Form Card -->
<div class="bg-white rounded-xl overflow-hidden animate-fade-in border border-gray-100" style="animation-delay: 0.1s;">
    <div class="bg-gradient-to-r from-amber-500 to-amber-600 px-5 sm:px-8 py-4 sm:py-6">
        <h2 class="text-lg sm:text-xl font-semibold text-white flex items-center space-x-2">
            <i class="bi bi-pencil text-base sm:text-lg"></i>
            <span>Form Edit Aturan</span>
        </h2>
    </div>
    
    <div class="p-5 sm:p-8">
        <form method="POST" action="{{ url_for('aturan.edit', id=aturan.id) }}" class="space-y-5 sm:space-y-6">
            <!-- Penyakit -->
            <div>
                <label for="kode_penyakit" class="block text-sm font-semibold text-gray-700 mb-2">
                    Penyakit <span class="text-red-500">*</span>
                </label>
                <select class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all text-sm sm:text-base" 
                        id="kode_penyakit" 
                        name="kode_penyakit" 
                        required>
                    {% for penyakit in penyakit_list %}
                    <option value="{{ penyakit.kode_penyakit }}" 
                            {% if penyakit.kode_penyakit == aturan.kode_penyakit %}selected{% endif %}>
                        {{ penyakit.kode_penyakit }} - {{ penyakit.nama_penyakit }}
                    </option>
                    {% endfor %}
                </select>
                <p class="mt-2 text-xs sm:text-sm text-gray-500 flex items-center space-x-1">
                    <i class="bi bi-info-circle"></i>
                    <span>Pilih penyakit yang sesuai dengan gejala</span>
                </p>
            </div>
            
            <!-- Gejala -->
            <div>
                <label for="kode_gejala" class="block text-sm font-semibold text-gray-700 mb-2">
                    Gejala <span class="text-red-500">*</span>
                </label>
                <select class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all text-sm sm:text-base" 
                        id="kode_gejala" 
                        name="kode_gejala" 
                        required>
                    {% for gejala in gejala_list %}
                    <option value="{{ gejala.kode_gejala }}" 
                            {% if gejala.kode_gejala == aturan.kode_gejala %}selected{% endif %}>
                        {{ gejala.kode_gejala }} - {{ gejala.nama_gejala }}
                    </option>
                    {% endfor %}
                </select>
                <p class="mt-2 text-xs sm:text-sm text-gray-500 flex items-center space-x-1">
                    <i class="bi bi-info-circle"></i>
                    <span>Pilih gejala yang berkaitan dengan penyakit</span>
                </p>
            </div>
            
            <!-- MB dan MD -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 sm:gap-6">
                <div>
                    <label for="mb" class="block text-sm font-semibold text-gray-700 mb-2">
                        MB (Measure of Belief) <span class="text-red-500">*</span>
                    </label>
                    <input type="number" 
                           step="0.1" 
                           min="0" 
                           max="1" 
                           class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all text-sm sm:text-base" 
                           id="mb" 
                           name="mb" 
                           value="{{ aturan.mb }}" 
                           required>
                    <p class="mt-2 text-xs sm:text-sm text-gray-500 flex items-center space-x-1">
                        <i class="bi bi-info-circle"></i>
                        <span>Nilai keyakinan (0.0 - 1.0)</span>
                    </p>
                </div>
                
                <div>
                    <label for="md" class="block text-sm font-semibold text-gray-700 mb-2">
                        MD (Measure of Disbelief) <span class="text-red-500">*</span>
                    </label>
                    <input type="number" 
                           step="0.1" 
                           min="0" 
                           max="1" 
                           class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all text-sm sm:text-base" 
                           id="md" 
                           name="md" 
                           value="{{ aturan.md }}" 
                           required>
                    <p class="mt-2 text-xs sm:text-sm text-gray-500 flex items-center space-x-1">
                        <i class="bi bi-info-circle"></i>
                        <span>Nilai ketidakpercayaan (0.0 - 1.0)</span>
                    </p>
                </div>
            </div>
            
            <!-- Info Alert -->
            <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 sm:p-4 flex items-start space-x-3">
                <div class="flex-shrink-0">
                    <div class="w-7 h-7 sm:w-8 sm:h-8 bg-amber-100 rounded-lg flex items-center justify-center">
                        <i class="bi bi-lightbulb text-amber-600 text-sm sm:text-base"></i>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-amber-900 mb-1 text-sm sm:text-base">Perhatian</h4>
                    <p class="text-xs sm:text-sm text-amber-700">Nilai CF akan dihitung otomatis dengan rumus: <span class="font-mono font-bold">CF = MB - MD</span>. Perubahan nilai dapat mempengaruhi akurasi diagnosis sistem.</p>
                </div>
            </div>
            
            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 pt-2 sm:pt-4">
                <button type="submit" 
                        class="flex-1 bg-amber-600 hover:bg-amber-700 text-white font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2 text-sm sm:text-base">
                    <i class="bi bi-check-lg"></i>
                    <span>Update Aturan</span>
                </button>
                <a href="{{ url_for('aturan.index') }}" 
                   class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 border border-gray-200 text-sm sm:text-base">
                    <i class="bi bi-x-lg"></i>
                    <span>Batal</span>
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Alert dismiss function
function dismissAlert(button) {
    const alertItem = button.closest('.alert-item');
    alertItem.classList.add('fade-out');
    setTimeout(() => {
        alertItem.remove();
        // Remove container if no alerts left
        const container = document.querySelector('.alert-container');
        if (container && !container.querySelector('.alert-item')) {
            container.remove();
        }
    }, 500);
}

// Auto dismiss alerts after 5 seconds
setTimeout(() => {
    const alertItems = document.querySelectorAll('.alert-item');
    alertItems.forEach(item => {
        item.classList.add('fade-out');
        setTimeout(() => {
            item.remove();
            const container = document.querySelector('.alert-container');
            if (container && !container.querySelector('.alert-item')) {
                container.remove();
            }
        }, 500);
    });
}, 5000);
</script>
{% endblock %}