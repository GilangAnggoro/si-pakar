{% extends 'base.html' %}

{% block title %}Tambah Gejala - Sistem Pakar{% endblock %}

{% block extra_css %}
<style>
    /* Alert positioning */
    .alert-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        width: 320px;
        max-width: 90vw;
    }

    @media (max-width: 640px) {
        .alert-container {
            top: 10px;
            right: 10px;
            width: 280px;
        }
    }

    @keyframes fadeOut {
        0% { opacity: 1; }
        100% { opacity: 0; }
    }

    .fade-out {
        animation: fadeOut 0.5s ease-out forwards;
    }
</style>
{% endblock %}

{% block content %}
<!-- Flash Messages - Fixed Position -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="alert-container">
        {% for category, message in messages %}
        <div class="alert-item mb-2 animate-fade-in">
            <div class="bg-white rounded-lg p-3 shadow-md {% if category == 'success' %}border-l-4 border-green-500{% elif category == 'danger' or category == 'error' %}border-l-4 border-red-500{% elif category == 'warning' %}border-l-4 border-yellow-500{% else %}border-l-4 border-blue-500{% endif %}">
                <div class="flex items-center space-x-2">
                    <i class="bi {% if category == 'success' %}bi-check-circle-fill text-green-500{% elif category == 'danger' or category == 'error' %}bi-x-circle-fill text-red-500{% elif category == 'warning' %}bi-exclamation-triangle-fill text-yellow-500{% else %}bi-info-circle-fill text-blue-500{% endif %} text-base flex-shrink-0"></i>
                    <span class="text-gray-700 font-medium text-xs flex-1">{{ message }}</span>
                    <button onclick="dismissAlert(this)" class="text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0">
                        <i class="bi bi-x text-base"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
{% endwith %}

<!-- Page Header -->
<div class="mb-6 sm:mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 animate-fade-in">
    <div>
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 flex items-center space-x-2 sm:space-x-3">
            <div class="w-9 h-9 sm:w-10 sm:h-10 bg-blue-50 rounded-lg flex items-center justify-center">
                <i class="bi bi-plus-circle text-blue-600 text-lg sm:text-xl"></i>
            </div>
            <span>Tambah Gejala</span>
        </h1>
        <p class="text-sm sm:text-base text-gray-500 mt-2">Tambahkan data gejala gangguan kecemasan baru</p>
    </div>
    
    <a href="{{ url_for('gejala.index') }}" 
       class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg transition-all duration-200 flex items-center justify-center sm:justify-start space-x-2 border border-gray-200 text-sm sm:text-base">
        <i class="bi bi-arrow-left"></i>
        <span>Kembali</span>
    </a>
</div>

<!-- Form Card -->
<div class="bg-white rounded-xl shadow-sm overflow-hidden animate-fade-in border border-gray-100" style="animation-delay: 0.1s;">
    <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-5 sm:px-8 py-4 sm:py-6">
        <h2 class="text-lg sm:text-xl font-semibold text-white flex items-center space-x-2">
            <i class="bi bi-file-earmark-plus text-base sm:text-lg"></i>
            <span>Form Tambah Gejala</span>
        </h2>
    </div>
    
    <div class="p-5 sm:p-8">
        <form method="POST" action="{{ url_for('gejala.create') }}" class="space-y-5 sm:space-y-6">
            <!-- Kode Gejala -->
            <div>
                <label for="kode_gejala" class="block text-sm font-semibold text-gray-700 mb-2">
                    Kode Gejala <span class="text-red-500">*</span>
                </label>
                <input type="text" 
                       class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm sm:text-base" 
                       id="kode_gejala" 
                       name="kode_gejala" 
                       placeholder="Contoh: G01" 
                       required>
                <p class="mt-2 text-xs sm:text-sm text-gray-500 flex items-center space-x-1">
                    <i class="bi bi-info-circle"></i>
                    <span>Masukkan kode unik untuk gejala</span>
                </p>
            </div>
            
            <!-- Nama Gejala -->
            <div>
                <label for="nama_gejala" class="block text-sm font-semibold text-gray-700 mb-2">
                    Nama Gejala <span class="text-red-500">*</span>
                </label>
                <textarea class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm sm:text-base" 
                          id="nama_gejala" 
                          name="nama_gejala" 
                          rows="3" 
                          placeholder="Masukkan nama gejala secara lengkap..." 
                          required></textarea>
                <p class="mt-2 text-xs sm:text-sm text-gray-500 flex items-center space-x-1">
                    <i class="bi bi-info-circle"></i>
                    <span>Deskripsi lengkap dari gejala</span>
                </p>
            </div>
            
            <!-- Pertanyaan -->
            <div>
                <label for="pertanyaan" class="block text-sm font-semibold text-gray-700 mb-2">
                    Pertanyaan (untuk Frontend) <span class="text-red-500">*</span>
                </label>
                <textarea class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm sm:text-base" 
                          id="pertanyaan" 
                          name="pertanyaan" 
                          rows="3" 
                          placeholder="Apakah Anda mengalami..." 
                          required></textarea>
                <p class="mt-2 text-xs sm:text-sm text-gray-500 flex items-center space-x-1">
                    <i class="bi bi-info-circle"></i>
                    <span>Pertanyaan ini akan ditampilkan kepada user saat konsultasi</span>
                </p>
            </div>
            
            <!-- Info Alert -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4 flex items-start space-x-3">
                <div class="flex-shrink-0">
                    <div class="w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="bi bi-lightbulb text-blue-600 text-sm sm:text-base"></i>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-blue-900 mb-1 text-sm sm:text-base">Tips Membuat Pertanyaan</h4>
                    <p class="text-xs sm:text-sm text-blue-700">Buat pertanyaan yang jelas dan mudah dipahami oleh pengguna. Gunakan bahasa yang sederhana dan tidak ambigu agar hasil diagnosis lebih akurat.</p>
                </div>
            </div>
            
            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 pt-2 sm:pt-4">
                <button type="submit" 
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 shadow-sm hover:shadow-md text-sm sm:text-base">
                    <i class="bi bi-check-lg"></i>
                    <span>Simpan Gejala</span>
                </button>
                <a href="{{ url_for('gejala.index') }}" 
                   class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 border border-gray-200 text-sm sm:text-base">
                    <i class="bi bi-x-lg"></i>
                    <span>Batal</span>
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Alert dismiss function
function dismissAlert(button) {
    const alertItem = button.closest('.alert-item');
    alertItem.classList.add('fade-out');
    setTimeout(() => {
        alertItem.remove();
        // Remove container if no alerts left
        const container = document.querySelector('.alert-container');
        if (container && !container.querySelector('.alert-item')) {
            container.remove();
        }
    }, 500);
}

// Auto dismiss alerts after 5 seconds
setTimeout(() => {
    const alertItems = document.querySelectorAll('.alert-item');
    alertItems.forEach(item => {
        item.classList.add('fade-out');
        setTimeout(() => {
            item.remove();
            const container = document.querySelector('.alert-container');
            if (container && !container.querySelector('.alert-item')) {
                container.remove();
            }
        }, 500);
    });
}, 5000);
</script>
{% endblock %}